{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>My amazing App</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/viz.js"></script>
</head>

<svg height="0" width="0">
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="5" orient="auto">
        <path d="M0,0 L0,10 L10,5 z" fill="black" />
    </marker>
</svg>


<body>


    <div style="border: 3px solid #fff; padding: 20px; width: 100%;">

        <div style="width: 40%; float: left;padding: 20px;border: 2px solid black;">
            <h1>The input area</h1>






            <form action="{% url 'compute' %}" method="post">
                {% csrf_token %}
                <textarea name="input_text" style="width: 90%; height: 200px; overflow-y: scroll;">arg(a1).arg(a2).att(a1,a2).</textarea>

                <div>
                    Gradual semantics:
                    <input type="radio" name="semantics" id="cat" value="cat" checked>
                    <label for="cat">H-categoriser semantics</label>

                    <input type="radio" name="semantics" id="max" value="max">
                    <label for="max">Max-based semantics</label>

                    <input type="radio" name="semantics" id="card" value="card">
                    <label for="card">Card-based semantics</label>
                </div>

                <button type="submit">Compute</button>
            </form>


            <h1>Console:</h1>
            <div id = "outputDiv" style="width: 90%; height: 200px; overflow-y: scroll; padding: 10px; border: 2px solid black; white-space:pre-wrap;"></div>


        </div>


        <div style="margin-left: 45%;  width: 50%;padding: 20px;border: 2px solid black;">
            <h1>Graph information</h1>
            <table id="degree_table" style="border: 1px solid;">
                <tr>
                    <th>Arguments</th>
                    <th>a1</th>
                    <th>a2</th>
                </tr>
                <tr>
                    <td>Degree</td>
                    <td>1</td>
                    <td>0.5</td>
                </tr>

            </table>

            <h1>The display area</h1>

            <div id="graph-container"></div>


        </div>
    </div>



</body>


<!--<script>-->



<!--    // Sample graph data (you can replace this with data from your Django view)-->
<!--    const graphData = {{ graph_data|safe }};-->

<!--    // Define the dimensions of the graph container-->
<!--    const width = "100%";-->
<!--    const height = "500px";-->


<!--    // Create an SVG element to render the graph-->
<!--    const svg = d3.select("#graph-container")-->
<!--        .append("svg")-->
<!--        .attr("width", width)-->
<!--        .attr("height", height);-->

<!--    // Create a D3 force simulation to layout the graph-->
<!--    var simulation = d3.forceSimulation()-->
<!--        .force("link", d3.forceLink().id(function(d) { return d.id; }))-->
<!--        .force('charge', d3.forceManyBody()-->
<!--            .strength(-1900)-->
<!--            .theta(0.5)-->
<!--            .distanceMax(1500)-->
<!--        )-->
<!--        .force('collision', d3.forceCollide().radius(function(d) {-->
<!--            return d.radius-->
<!--        }))-->
<!--        .force("center", d3.forceCenter(document.querySelector("#graph-container").clientWidth / 2, document.querySelector("#graph-container").clientHeight / 2));-->

<!--    var defs = svg.append("defs");-->
<!--    defs.append("radialGradient")-->
<!--        .attr("id", "source-gradient")-->
<!--        .selectAll("stop")-->
<!--        .data([-->
<!--            {offset: "20%", color: "#eda515"},-->
<!--            {offset: "100%", color: "#827777"},-->
<!--        ])-->
<!--        .enter().append("stop")-->
<!--        .attr("offset", function(d) { return d.offset; })-->
<!--        .attr("stop-color", function(d) { return d.color; });-->

<!--    const link = svg.append("g")-->
<!--        .selectAll("line")-->
<!--        .data(graphData.links)-->
<!--        .enter()-->
<!--        .append('line')-->
<!--        .attr('x1', d => d.source.x)-->
<!--        .attr('x2', d => d.target.x)-->
<!--        .attr('y1', d => d.source.y)-->
<!--        .attr('y2', d => d.target.y)-->
<!--        .style("stroke", "black")  // Set the color of the links-->
<!--        .style("stroke-width", 2) // Set the width of the links;-->
<!--        .attr("marker-end", "url(#arrow)");-->

<!--    const node = svg.append("g")-->
<!--        .selectAll("circle")-->
<!--        .data(graphData.nodes)-->
<!--        .enter()-->
<!--        .append("circle")-->
<!--        .attr("r", 35)-->
<!--        .style("fill", "url(#source-gradient)" )-->
<!--        .style("opacity", 0.5)-->
<!--        .call(d3.drag()-->
<!--            .on("start", dragstarted)-->
<!--            .on("drag", dragged)-->
<!--            .on("end", dragended));-->

<!--    var label = svg.append("g")-->
<!--        .attr("class", "labels")-->
<!--        .selectAll("text")-->
<!--        .data(graphData.nodes)-->
<!--        .enter().append("text")-->
<!--        .text(function(d) { return d.name; })-->
<!--        .attr("class", "label")-->
<!--        .style("text-anchor", "middle")-->
<!--        .style("font-size", "20px");-->

<!--    // Define the tick function to update node and link positions-->
<!--    simulation.nodes(graphData.nodes)-->
<!--        .on("tick", ticked);-->

<!--    simulation.force("link")-->
<!--        .links(graphData.links);-->

<!--    // Tick function to update node and link positions-->
<!--    function ticked() {-->
<!--        link-->
<!--            .attr("x1", d => d.source.x)-->
<!--            .attr("y1", d => d.source.y)-->
<!--            .attr("x2", d => d.target.x)-->
<!--            .attr("y2", d => d.target.y);-->

<!--        node-->
<!--            .attr("cx", d => d.x)-->
<!--            .attr("cy", d => d.y);-->

<!--        label-->
<!--            .attr("x", function(d) { return d.x; })-->
<!--            .attr("y", function (d) { return d.y; });-->
<!--    }-->

<!--    // Functions for drag behavior-->
<!--    function dragstarted(event, d) {-->
<!--        if (!event.active) simulation.alphaTarget(0.3).restart();-->
<!--        d.fx = d.x;-->
<!--        d.fy = d.y;-->
<!--    }-->

<!--    function dragged(event, d) {-->
<!--        d.fx = event.x;-->
<!--        d.fy = event.y;-->
<!--    }-->

<!--    function dragended(event, d) {-->
<!--        if (!event.active) simulation.alphaTarget(0);-->
<!--        d.fx = null;-->
<!--        d.fy = null;-->
<!--    }-->



<!--    function updateGraph(newData) {-->
<!--        // Your D3.js code to update the graph with new data-->

<!--        //We remove the previous elements-->
<!--        /*svg.selectAll("line").remove()-->
<!--        svg.selectAll("circle").remove()-->
<!--        svg.selectAll("text").remove()*/-->

<!--        node.data(newData.nodes)-->
<!--            .enter()-->
<!--            .append("circle")-->
<!--            .merge(node)-->
<!--            .attr("r", 35)-->
<!--            .style("fill", "url(#source-gradient)")-->
<!--            .style("opacity", 0.5)-->
<!--            .call(d3.drag()-->
<!--                .on("start", dragstarted)-->
<!--                .on("drag", dragged)-->
<!--                .on("end", dragended));-->

<!--        link.data(newData.links)-->
<!--            .enter()-->
<!--            .append('line')-->
<!--            .merge(link)-->
<!--            .attr('x1', d => d.source.x)-->
<!--            .attr('x2', d => d.target.x)-->
<!--            .attr('y1', d => d.source.y)-->
<!--            .attr('y2', d => d.target.y)-->
<!--            .style("stroke", "black")-->
<!--            .style("stroke-width", 2)-->
<!--            .attr("marker-end", "url(#arrow)");-->

<!--        label.data(newData.nodes)-->
<!--            .enter()-->
<!--            .append("text")-->
<!--            .merge(label)-->
<!--            .text(function (d) { return d.name; });-->

<!--        // Restart the simulation-->
<!--        simulation.nodes(newData.nodes);-->
<!--        simulation.force("link").links(newData.links);-->
<!--        simulation.alpha(1).restart();-->
<!--    }-->


<!--</script>-->

<script>
    //To update the console when clicking and building the dable
    $(document).ready(function () {
        $('form').on('submit', function (event) {
            event.preventDefault();
            $.ajax({
                type: 'POST',
                url: '{% url "compute" %}',
                data: $(this).serialize(),
                success: function (data) {
                    $('#outputDiv').text(data.console);
                    updateGraph(data.graph_data);
                }
            });

            $.ajax({
                type: 'POST',
                url: '{% url "compute" %}',
                data: $(this).serialize(),
                success: function (data) {

                    var table = document.getElementById("degree_table");
                    var arg_graph = data.information_arg;

                    // Clear existing columns except the first one
                    for (var j=0; j<2; j++){
                        var headerRow = table.rows[j];
                        headerRow.style.border = "1px solid";
                        for (var i = headerRow.cells.length - 1; i > 0; i--) {
                            headerRow.deleteCell(i);
                        }
                    }

                    // Add rows from JSON data
                    for (var i = 0; i < arg_graph.length; i++) {
                        var cell1 = table.rows[0].insertCell(table.rows[0].cells.length);
                        var cell2 = table.rows[1].insertCell(table.rows[1].cells.length);
                        cell1.innerHTML = arg_graph[i].arg;
                        cell2.innerHTML = arg_graph[i].degree;
                        cell1.style.border = "1px solid";
                        cell2.style.border = "1px solid";
                    }

                    const jsonGraph = {
                        dot: data.gdata_input,
                        format: 'svg' // or 'png', 'dot', 'pdf', etc.
                    };

                    // Render the graph
                    const graphContainer = document.getElementById('graph-container');
                    const svgString = Viz(jsonGraph.dot, { format: jsonGraph.format });
                    graphContainer.innerHTML = svgString;


                }
            });

        });
    });




</script>


</html>